<!DOCTYPE html>
<html>
<head>
    <title>Untitled Document</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
     <script src="js/jquery-3.2.1.min.js"></script>
    <!--    네브바 css-->
    <link rel= "stylesheet" type="text/css" href="css/nav.css">
<!--    네브바 js, 세션검사 -->
    <script src="js/nav.js"></script>
</head>
    <style>
        
        body{
            width: 1200px;
            height: auto;
            margin: auto;
            background-color: white;
        }
        #userIn{
            border: 3px solid gray;
            margin-top: 20px;
            width: 370px;
            height: 110px;
            cursor: pointer;
            margin: auto;
            border-radius: 20px;
            margin-top: 30px;
            background-color: antiquewhite;
        }
        #userImg{
            margin-left: 30px;
            border: 1px solid aqua;
            width: 110px;
            border-radius: 110px;
            height: 100px;
            margin-left: 5px;
            margin-top: 5px;
            display: inline-block;
            position: absolute;
        }
        #userName{
            border-radius: 10px;
            border: 1px solid black;
            width: 230px;
            height: 45px;
            display: inline-block;
            margin-left: 120px;
            margin-top: 5px;
            padding-top: 10px;
            padding-left: 10px;
            font-size: 20px;
            text-align: center;
        }
        #userBirth{
            border: 1px solid gray;
            width: 100px;
            height: 45px;
            margin-left: 120px;
            border-radius: 10px;
            display: inline-block;
            text-align: center;
            font-size: 15px;
        }
        #userPhone{
            border: 1px solid gray;
            width: 140px;
            height: 45px;
            text-align: center;
            display: inline-block;
            border-radius: 10px;
            font-size: 15px;
        }
/*        ///////////////////////////////////////////////////////////////////////////////////////////////*/
        /*        모달창 css 매긴곳.*/
        #realFriend{
            display: none;
            position: fixed;
            transform: translate(-50%, -50%);
            top: 30%;
            left: 30%;
            opacity: 1;
            box-shadow: 0px 10px 14px 0px rgba(0, 0, 0, 0.2);
            
            width: 530px;
            height: 300px;
            background-color: beige;
            z-index: 50;
            
        }
        #findUserImg{
            
            width: 110px;
            height: 100px;
            margin-left: 5px;
            margin-top: 5px;
            display: inline-block;
            position: absolute;
        }
        #findUserName{
            border: 1px solid black;
            width: 229px;
            height: 45px;
            display: inline-block;
            margin-left: 120px;
            margin-top: 5px;
            color: black;
            
            
        }
        #findUserBirth{
            border: 1px solid black;
            width: 100px;
            height: 45px;
            margin-left: 120px;
            margin-top: 5px;
            display: inline-block;
            text-align: center;
            color: black;
            
        }
        #findUserPhone{
            border: 1px solid black;
            width: 123px;
            height: 45px;
            text-align: center;
            display: inline-block;
            color: black;
            
        }
        #modalAddFriend{
            width: 500px;   
            
        }
        #findFriend{
            text-align: center;
            margin-top: 20px;
            font-size: 30px;
            width: 450px;
            margin-left: 25px;
            color: black;
            
        }
        #findPhoneNumber{
            width: 350px;
            height: 40px;
            margin-left: 25px;
            margin-top: 20px;
            padding-left: 10px;
        }
        #findButton{
            width: 70px;
            height: 45.5px;
            margin-left: 2px;
        }
        #findUserIn{
            margin-top: 20px;
            margin-left: 25px;
            
        }
        #btnAddFriend{
            width: 100px;
            height: 100px;
            display: inline-block;
            position: absolute;
            top: 150px;
            margin-left: 20px;
            
        }
        #findedFriend{
            width: 470px;
            height: 150px;
            
        }
        #delFriend{
            width: 50px;
            height: 50px;
            
        }
        #ch{
            margin-left: 10px;
            margin-top: 10px;
        }
        .eachFriendRequest{
            border: 1px solid black;
            margin: 20px;
        }
        
        .requestFriendImg{
            width: 100px;
            height: 100px;
        }
        
        
    #blindCover{
        position: absolute;
        top: 0;
        left: 0;
        background-color: black;
        opacity: 0.7;
        display: none;
    }
/*        친구 검색 모달*/
        
        #modal{
            position: fixed;
            top: 50%;
            left: 50%;
            background-color: white;
            transform: translate(-50%,-50%);
            width: 300px;
            height: 150px;
            z-index: 1000;
            overflow: hidden;
            display: none;
        }
        
        .searchTab{
            width: 49%;
            text-align: center;
            height: 60px;
            line-height: 60px;
            font-size: 13px;
            display: inline-block;
            cursor: pointer;
        }
        #idSearch{
            display: none;
        }
        .inputText{
            display: inline-block;
            width: 200px;
            height: 24px;
            margin: auto;
            padding-left: 20px;
            margin-left: 10px;
            border: none;
            border-bottom: 1px solid gray;
            background-color: transparent;
        }
        .btn{
            display: inline-block;
            cursor: pointer;
            font-size: 13px;
            width: 50px;
            height: 24px;
            line-height: 24px;
            text-align: center;
        }
        .searchCover{
            border-top: 1px solid black;
            padding: 30px 0 30px 0;
        }
        #infoCover{
            display: inline-block;
            width: 190px;
            height: 100px;
        }
        #imgCover,#friendImg{
            display: inline-block;
            width: 100px;
            height: 100px;
        }
        .addfriendBtn{
            width: 100px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            font-size: 13px;
            cursor: pointer;
            margin: 0 auto 20px auto;
        }
        .requestMsg{
            text-align: center;
        }
        #contents{
            margin-left: 120px;
        }
        
        #topCover{
            border-bottom: 1px solid gray;
        }
        
        .topListbtn{
            display: inline-block;
            width: 100px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 13px;
            cursor: pointer;
        }
        #responseExist{
            
            border: 1px solid black;
            margin: 10px;
        }
        
        .responsingFImg{
            width: 100px;
            height: 100px;
            
        }
    
    </style>
    <script>
           
        /////친구 목록 가져오기.
        $.ajax({
           type:"post",
            url:"friends.do",
            data:$('#allFriends').serialize(),
            dataType:"json",
            success:function(data){
                var result = data[0].result;
                var out = '';
                
                
                for(var i=0; i < data.length; i++){
                    out += '<div id="userIn">';
                    out += '<div id="userImg"></div>';
                    out += '<img src="'+ data[i].MEMBER_IMG +'" id="userImg">';
                    out += '<div id="userName">'+ data[i].MEMBER_NAME +'</div>';
                    out += '<div id="userBirth">'+ data[i].MEMBER_BIRTH +'</div>';
                    out += '<div id="userPhone">'+ data[i].MEMBER_PHONE +'</div>'
                    out += '<input type="hidden" value="아이디" id="MEMBER_ID" name="'+ data[i].MEMBER_ID +'">';
                    out += '<input type="button" value="친구삭제" onclick="deleteMyfriend(this)"/></div>';
                    
                }
                document.getElementById('allFriends').innerHTML = out;
            },error: function(req) {

                    alert("상태 : " + req.status + ", " + req.responseText + ", error : " + req.error + " : friends.do" );
                }
            
            
            
        });
        
        
         function requestFriendMe(){
            
              $.ajax({
                type: "post", 
                url: "RequestingFriend.do",                
                dataType:"json",
                success: function (data){
                    
//                    console.log(data);
                    
//                    console.log(data.length);
                    if(data.length != 0){
//                        console.log("!");
                        $('#requestExist').html('');
                        for(var index = 0; index < data.length; index ++){
                        document.getElementById("requestExist").innerHTML += "<div class='eachFriendRequest'>"
                            + "<img src ='" + data[index].friendImg + "' class='requestFriendImg' />"
                            + "<div class='requestFriendName'>" + data[index].friendId + "님에게 친구요청이 왔습니다.</div>"
                            + "<div> 이름 : " + data[index].friendName + "</div>"
                            + "<div> 전화번호 : " + data[index].friendPhone + "</div>"
                            + "<input type=button value='수락' onclick='acceptRequest(this)'/><input type=button value='거절' onclick=refuseRequest(this)/></div>";
                        
                        
                        }
                    }else{
                        document.getElementById("requestExist").innerHTML = "<div> 받은 친구 요청이 없습니다. </div>";
                    }
                }, error: function(req) {

                    alert("상태 : " + req.status + ", " + req.responseText + ", error : " + req.error + ":RequestingFriend.do");
                }
            });
            
            
            
            
        }
        
        
        
        function acceptRequest(a){//친구요청 수락
            var acceptFriendId = $(a).prev().prev().prev().text().split("님")[0]; //요청 수락할 친구 ID
            
             $.ajax({
                type: "post",                  
                url: "AcceptRequest.do",                
                data:{
                    acceptFriendId : acceptFriendId
                },
                dataType:"json",
                success: function (data){
          
                    
                    
                    
                    
                }, error: function(req) {
                    alert("상태 : " + req.status + ", " + req.responseText + ", error : " + req.error + " : AcceptRequest.do");
                }
            });
//            location.reload();
            location.href="friendList.html";
        }
        
        
        function deleteMyfriend(a){
            
            var deleteId = $(a).prev().attr("name");
            
            $.ajax({
                type:"post",
                url:"DeleteFriend.do",
                data:{
                    deleteId : deleteId                    
                },
                dataType:"json",
                success:function(data){
                    if(data[0].result == "delete")
                        alert(deleteId + "친구 삭제 완료!");
                    
                    location.reload();
                    
                },error: function(req) {

                    alert("상태 : " + req.status + ", " + req.responseText + ", error : " + req.error + "DeleteFriend.do" );
                }
                
            });
            
            
            
            
            
        }
        
     
        
        
        function addFriend(){
            $('#realFriend').css('display','inline-block');
            $('cont1').css('opacity','1');
        }
        

               
    function tabChange(id){
        var ids = $(id).attr('id');
        $('#allFriends').css('display','none');
        $('#requestExist').css('display','none');
        $('#responseExist').css('display','none');
        if(ids == 'allFriend'){
            $('#allFriends').css('display','inline-block');
        }else if(ids == 'getFriends'){
            $('#requestExist').css('display','inline-block');
            requestFriendMe();
        }else if(ids == 'sendFriends'){            
            $('#responseExist').css('display','inline-block');
//            alert("!!!");
//            responseExist
            
            $.ajax({
                type: "post", 
                url: "ResponsingFriends.do",               
                dataType:"json",
                success: function (data){ 
                              
                    var out = "";
                    for(var h = 0; h < data.length; h++){                       
                        out += "<img src='" + data[h].userImg + "'class= 'responsingFImg'/>"
                        + "<div>아이디 : " + data[h].userId + "</div>"
                        + "<div>이름 : " + data[h].userName + "</div>"
                        + "<div>전화번호 : " + data[h].userPhone + "</div>";
                        
                    }
                    
                    $("#responseExist").html(out);
                }, error: function(req) {

                    alert("상태 : " + req.status + ", " + req.responseText + ", error : " + req.error + ": ResponsingFriends.do");
                }
            });
            
            
            
            
            
        }
    }    
        
    function viewSearch(){
        $('#modal').css('display','block');
        $('#blindCover').css('display','block');
        
    }
        


        
        var friendId = "";
        
       
        
        function heightAnimation(tagId,height,time){
             $('#'+tagId).animate({

                height:height,

            }, time);        
        }
        
        function requestFriend(){

            
            $.ajax({
                type: "post", 
                url: "RequestFriend.do",
                data:{
                    friendId: friendId
                    
                },
                dataType:"json",
                success: function (data){
                    
                    
                    console.log(data);
                    if(data[0].friendExist == "Exist")
                        document.getElementById("phoneSearchList").innerHTML = "<div class='requestMsg'> 이미 친구입니다. </div>";
                    else if(data[0].friendExist == "notExist")
                        document.getElementById("phoneSearchList").innerHTML = "<div class='requestMsg'> 친구요청을 보냈습니다. </div>";    
                    else if(data[0].friendExist == "requestExist")
                        document.getElementById("phoneSearchList").innerHTML = "<div class='requestMsg'> 이미 친구요청을 하였습니다. </div>";    
                    else if(data[0].friendExist == "responseExist")
                        document.getElementById("phoneSearchList").innerHTML = "<div class='requestMsg'> 상대방이 나에게 친구 요청을 하였습니다. </div>"; 
                    else if(data[0].friendExist == "me")
                        document.getElementById("phoneSearchList").innerHTML = "<div class='requestMsg'> 자기 자신한테는 요청할수 없습니다. </div>";    
                
                    heightAnimation('modal',180 , 500 );
                }, error: function(req) {

                    alert("상태 : " + req.status + ", " + req.responseText + ", error : " + req.error + ": RequestFriend.do");
                }
            });
            
            
            
            
            
        }
        
    function closeModal(){
        $('#blindCover').css('display','none');
        $('#messagMeodal').remove();
        $('#modal').css('display','none');
        
    }
            
    $(document).ready(function(){
        
        $('#blindCover').css("height",$(window).height());
        $('#blindCover').css("width",$(window).width());
        
        $(window).resize(function(){
        
            $('#blindCover').css("height",$(window).height());
            $('#blindCover').css("width",$(window).width());
            
        });
        
    });
        function changeTab(id){
            $('#phoneSearchList').html("");
            var ids = $(id).attr('id');
            if(ids == 'phoneTab'){
                $('#phoneSearch').css('display','block');
                $('#idSearch').css('display','none');
                
                $('#phoneTab').css('background-color','gray');
                $('#idTab').css('background-color','white');
            }else {
                $('#idSearch').css('display','block');
                $('#phoneSearch').css('display','none');
                
                $('#phoneTab').css('background-color','white'); 
                $('#idTab').css('background-color','gray'); 
            }
                heightAnimation('modal',150 , 500 );
        }
    
        
        
        
        function idSearch(){
            
            var friendId = $('#idSearchInput').val();
            var friendImg = "";
            
            var friendName = "";
            var friendPhoneNum = "";
            var friendGender ="";
            var friendBirth = "";
            
             $.ajax({
                
                
                type: "post", 
                url: "friendPhoneSearch.do",
                data:{
                    friendPhoneId: friendId,
                    selectPhoneOrId: "1"
                    
                },
                dataType:"json",
                success: function (data){
                   
                    
                    if(data[0].userExist == "Exist"){
                        console.log(data);
                        friendImg = data[0].friendImg;
                        friendId = data[0].friendId;
                        friendName = data[0].friendName;
                        friendPhoneNum = data[0].friendPhone;
                        friendGender = data[0].friendGender;
                        friendBirth = data[0].friendBirth;
                        var out = "";
                        out = "<div><div id='imgCover'><img src='" + friendImg + "' id='friendImg'/></div>";
                        out += "<div id='infoCover'><div id='friendId'> 아이디 : " + friendId + "</div>";
                        out += "<div id='friendName'> 이름 : " + friendName + "</div>";
                        out += "<div id='friendPhone'> 전화번호 : " + friendPhoneNum + "</div>";
                        out += "<div id='friendBirth'> 생년월일 : " + friendBirth + "</div></div></div>";
                        out += "<div class='addfriendBtn' onclick='requestFriend()'>친구요청하기</div>";
                        $('#idSearchList').html(out);
                        heightAnimation('modal',300 , 500 );
                    }else if(data[0].userExist == "notExist"){
                        
                        $('#idSearchList').html("<div class='requestMsg'>없는 사용자입니다.</div>");
                        heightAnimation('modal',180 , 500 );
                    }
                    
                    
                   
                }, error: function(req) {

                    alert("상태 : " + req.status + ", " + req.responseText + ", error : " + req.error + " : friendPhoneSearch.do");
                }
            });
            
            
            
        }
        
         function phoneSearch(){// 전화번호로 친구 찾기
            var friendPhone = $('#phoneSearchInput').val();
            var friendImg = "";
            
            var friendName = "";
            var friendPhoneNum = "";
            var friendGender ="";
            var friendBirth = "";
           
            
            
//            console.log(friendPhone)
            
            $.ajax({
                
                
                type: "post", 
                url: "friendPhoneSearch.do",
                data:{
                    friendPhoneId: friendPhone,
                    selectPhoneOrId: "0"
                },
                dataType:"json",
                success: function (data){
                   
                    
                    if(data[0].userExist == "Exist"){
                        console.log(data);
                        friendImg = data[0].friendImg;
                        friendId = data[0].friendId;
                        friendName = data[0].friendName;
                        friendPhoneNum = data[0].friendPhone;
                        friendGender = data[0].friendGender;
                        friendBirth = data[0].friendBirth;
                        var out = "";
                        out = "<div><div id='imgCover'><img src='" + friendImg + "' id='friendImg'/></div>";
                        out += "<div id='infoCover'><div id='friendId'> 아이디 : " + friendId + "</div>";
                        out += "<div id='friendName'> 이름 : " + friendName + "</div>";
                        out += "<div id='friendPhone'> 전화번호 : " + friendPhoneNum + "</div>";
                        out += "<div id='friendBirth'> 생년월일 : " + friendBirth + "</div></div></div>";
                        out += "<div class='addfriendBtn' onclick='requestFriend()'>친구요청하기</div>";
                        $('#phoneSearchList').html(out);
                        heightAnimation('modal',300 , 500 );
                    }else if(data[0].userExist == "notExist"){
                        
                        $('#phoneSearchList').html("<div class='requestMsg'>없는 사용자입니다.</div>");
                        heightAnimation('modal',180 , 500 );
                    }
                }, error: function(req) {

                    alert("상태 : " + req.status + ", " + req.responseText + ", error : " + req.error + ": friendPhoneSearch.do");
                }
            });
            
        }
        
        
    </script>
    
<body>
    
    <div id="wrap">
    <nav class="left_nav">
        <div id="userInfo">
            <ul id="user_Img_Cover" class="nav_ul" onclick="location.href='myInfo.html'">
                <li class="nav_li">
                    <img id="user_Img" src="/img/member/basis_photo.png"/>
                </li>
                <li class="nav_li">
                    <div id="user_Id"></div>
                </li>
            </ul>
        </div>
        <ul class="nav_ul" id="nav_menu">
            <li class="nav_li"><a class="nav_text" style="background-color:#182D42;" href="#">홈</a></li>
            <li class="nav_li"><a class="nav_text" href="myCalendar.html">개인 캘린더</a></li>
            <li class="nav_li"><a class="nav_text" href="groupList.html">단체 캘린더</a></li>
            <li class="nav_li"><a class="nav_text" href="friendList.html">친구 목록</a></li>
            <li class="nav_li"><a class="nav_text" href="qnaList.html">문의 하기</a></li>
        </ul>
        <ul id="logout" class="nav_ul" onclick="logout()">
            <li class="nav_li"><a class="nav_text" onclick="logout();">로그아웃</a></li>
        </ul>
    </nav>
        
    <div id="contents">
                       
        <div id="topCover">
            <div class="topListbtn" id="allFriend" onclick="tabChange(this)"> 전체 </div>
            <div class="topListbtn" id="getFriends" onclick="tabChange(this)"> 받은 친구 요청 </div>
            <div class="topListbtn" id="sendFriends" onclick="tabChange(this)"> 보낸 친구 요청 </div>
            <div class="topListbtn" id="searchFriends" onclick="viewSearch()"> 검색 </div>
        
        </div>
             
        
    <!-- 친구 목록 띄워줌-->
        <div id="allFriends">

        </div> 
        
    <!--        요청 온 친구 목록-->
    <div id="requestExist">
    </div>

<!--        보낸 친구 목록-->
        <div id="responseExist">
        </div>
        
        </div>                
    </div>
    

    
    <div id = "addFriends" style="margin-left:120px">
       
       
            <div id = 'modal'> 
                <div class="searchTab" id="phoneTab" onclick="changeTab(this)"> 연락처로 친구 찾기 </div>
                <div class="searchTab" id="idTab" onclick="changeTab(this)"> 아이디로 친구 찾기 </div>
                
                
                <div id="heightGet">
                    
                <div id='phoneSearch' class="searchCover">
                    <div id="inputPhone">
                        <input type='text' id="phoneSearchInput" class="inputText" placeholder='전화번호를 입력하세요' onkeyup='if(event.keyCode==13) {phoneSearch();}'/>
                    <div class="btn" onclick='phoneSearch();' >검색</div>
                    </div>
                </div>
                
                <div id='idSearch' class="searchCover">
                    <input type='text' id="idSearchInput" class="inputText" placeholder='아이디를 입력하세요' onkeyup='if(event.keyCode==13) {idSearch();}'/>
                    <div class="btn" onclick='idSearch();' >검색</div>
                </div>    
<!--                검색 결과-->
                    <div id="phoneSearchList">
                    
                        
                    </div>
                    <div id="idSearchList">
                    
                        
                    </div>
                </div>
            </div>
                    <div id="blindCover" onclick="closeModal();">
            </div>
        
        
        


        
    
    </div>
    
</body>
</html>
