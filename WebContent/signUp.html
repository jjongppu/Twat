<!DOCTYPE html>
<html>
<head>
    
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="js/jquery-3.2.1.min.js"></script>    
<style>
    * {
        background-color: #D7D2BF;
    }
    .mainText {
        margin-top: 100px;
    }
    
    .container {
        text-align: center;
        width: 450px;
        margin: 0 auto;
        
    }
    
    .idpwContaioner {
/*        border: 1px solid darkgray;*/
        margin: 70px 0 50px 0;
        
    }
    
    .infoContainer {
/*        border: 1px solid darkgray;*/
        margin-bottom: 50px;
    }
    
    .inputBox{
        width: 80%;
        height: 32px;
        margin: 6px 0;
        padding-left: 8px;  
        border: none;
        border-bottom: 1px solid darkgray;
    }
    
    
    #genderDiv {
/*        height: 40px;*/
/*        border: 1px solid darkgray;*/
/*        position: relative;*/
        margin-top: 20px;
    }
    #genderSmallDiv {
        position: absolute;
        text-align: center;
        height: 38px;
    }
    
    .genderBtn {
        border: none;
        background-color: white;
        height: 30px;
        color: darkgray;
/*        margin: 0;*/
/*
        float: left;
        display: inline-block;
*/
/*        width: 30%;*/
    }
    #man {
        border: 1px solid darkgray;
/*        width: 135px;*/
    }
    #woman {
        border: 1px solid darkgray;
/*        width: 135px;*/
    }
    
    .btns {
        width: 25%;
        border: none;
        height: 30px;
        margin: 6px 0 0 0;
        background-color: #80aaff;
        color: white;
    }
    #yearBox{
        width: 25%;
    }
    #monthBox{
        width: 25%;
    }
    #dayBox{
        width: 25%;
    }

    
</style>
    
<script>
	
	// 전역 변수
	idTF = false;
	pwTF = false;
	nameTF = false;
	birthTF = false;
	
    // 성별 M/F
    function test(a) {
        console.log($(a).val());
    }
	
    
    
    function signUpEnter() {
        // 빈칸인 상태에서 회원가입 눌렀을때 검사........ 성별을 어떻게 검사할지 아직..
        overlapId();
        checkPassword();
		checkName();
		checkBirth();
		
        if($('#pwBox').val() == "") {
            alert("비밀번호를 입력하세요.");
            $('#pwBox').focus();
        } else if($('#phoneBox').val() == "") {
            alert("전화번호를 입력하세요.");
            $('#phoneBox').focus();
        } else if(idTF && pwTF && nameTF && birthTF) {
            $.ajax ({
				type : 'post',
				url : 'signUp.do',
				data : $('#personalInfo').serialize(),
	//            data :
	//            {
	//                signUpId : document.getElementById("signUpId").value,
	//                signUpPw : document.getElementById("signUpPw").value,
	//                signUpImg : document.getElementById("signUpImg").value,
	//                signUpName : document.getElementById("signUpName").value,
	//                signUpGender : document.getElementById("signUpGender").value,
	//                signUpBirth : document.getElementById("signUpBirth").value,
	//                signUpPhone : document.getElementById("signUpPhone").value
	//            },
				dataType : "json",
				success : function(data) {
					console.log(data);
					var result = data[0].result;
                    

                    if(result == 'success') {
                        alert('회원가입이 완료되었습니다.');
                        location.href="index.html";
                    }else{
                        alert('회원가입에 실패하였습니다.');
                    }

				},
				error: function(req) {
					alert("상태 : " + req.status + ", " + req.responseText + ", error :" + req.error + "signUp.do");
				}
        });
        }
      
        
    }
    
	
	// 이름 유효성 검사 진행중..
	function checkName() {
		var nameRegex = /^[가-힣]{2,4}$/;
		var name = $('#nameBox').val();
		
		if(name == "") {
			$('#nameMessage').html("<p style='font-size:10px; color:red'>이름은 필수 입력 사항입니다.</p>");
			nameTF = false;
            $('#nameBox').focus();
		} else if(!nameRegex.test(name)) {
			$('#nameMessage').html("<p style='font-size:10px; color:red'>한글로만 입력해주세요.</p>");
			nameTF = false;
		} else {
			nameTF = true;
		}
	}

    // 비밀번호 길이, 같은지, 정규식 검사
//    function onkeyupPwCheck() {
//        var pw1 = $('#pwBox').val();
//        var pw2 = $('#pwBox2').val();
//        var pwVal = $('#pwBox').val().length;
//        var retVal = false;
//        var pwRegex = /^.*(?=.{6,20})(?=.*[0-9])(?=.*[a-zA-Z]).*$/; // 영문, 숫자 조합
//        
//		console.log(pw1);
//		console.log(pw2);
//		console.log(pwVal);
//		
//		
//		// 비밀번호
//        if(pw1 != null && pw2 != null) {
//            if(pwVal < 8 || pwVal > 16) {
//                $('#pwMessage').html("<p style='font-size:10px; color:red'>비밀번호는 8자 이상, 16자 이하여야 합니다.</p>");
//            } else if(pw1 != pw2) {
//                $('#pwMessage').html("<p style='font-size:10px; color:red'>사용할 수 없는 비밀번호입니다.</p>");
//            } else if(!pwRegex.test(pwVal)){
//                $('#pwMessage').html("<p style='font-size:10px; color:red'>비밀번호는 영문, 숫자로 구성되어야 합니다.</p>");
//            } else {
//                $('#pwMessage').html("<p style='font-size:10px; color:blue'>사용 가능한 비밀번호입니다.</p>");
//            }
//        }
//        
//    }
    ///비밀번호 유효성검사2
     function checkPassword2(){
            var pw1 = $('#pwBox').val();
            var pw2 = $('#pwBox2').val();
            var pwVal = $('#pwBox').val().length;
            var retVal = false;
            var pwRegex = /^.*(?=.{6,20})(?=.*[0-9])(?=.*[a-zA-Z]).*$/; // 영문, 숫자 조합
            
            if(pw2 != pw1){
                $('#pwMessage').html("<p style='font-size:10px; color:red'>비밀번호가 일치하지 않습니다.</p>");
            }
        }

        function checkPassword(){
            var pw1 = $('#pwBox').val();
            var pw2 = $('#pwBox2').val();
            var pwVal = $('#pwBox').val().length;
            var retVal = false;
            var pwRegex = /^.*(?=.{6,20})(?=.*[0-9])(?=.*[a-zA-Z]).*$/; // 영문, 숫자 조합
		
        if(pw1 != null && pw2 != null) {
            if(pwVal < 8 || pwVal > 16) {
                $('#pwMessage').html("<p style='font-size:10px; color:red'>비밀번호는 8자 이상, 16자 이하여야 합니다.</p>");
				pwTF = false;
            } else if(pw1 != pw2 && pw2 != pw1) {
                $('#pwMessage').html("<p style='font-size:10px; color:red'>비밀번호가 일치하지 않습니다.</p>");
				pwTF = false;
            } else if(!pwRegex.test(pwVal) && !pwRegex.test(pw2)){
                $('#pwMessage').html("<p style='font-size:10px; color:red'>비밀번호는 영문, 숫자로 구성되어야 합니다.</p>");
				pwTF = false;
            } else if(pw2 == pw1){
                $('#pwMessage').html("<p style='font-size:10px; color:blue'>사용 가능한 비밀번호입니다.</p>");
				pwTF = true;
            } else if(pw1 == ""){
                $('#pwMessage').html("<p style='font-size:10px; color:blue'>비밀번호를 입력해주세요.</p>");
				pwTF = false;
            } else{
                $('#pwMessage').html("<p style='font-size:10px; color:blue'>비밀번호가 일치하지 않습니다.</p>");
				pwTF = false;
            }
            
        }
            
         
    }

    
    
    // 아이디 실시간 검색 ........테스트중.......
//        function overlapId() {
//			var result = data[0].result;
//				var idVal = $('#idBox').val().length;
//				var idVal2 = $('#idBox').val();
//				var idRegex = /^[a-z]+[a-z0-9]{6,12}$/g;
//				
//                console.log(result);
//				// 1번
//                if(result == 'fail') {
//					if(idVal < 6 || idVal > 12) {
//						$('#idMessage').html("<p style='font-size:10px; color:red'>아이디는 6자 이상, 12자 이하여야 합니다.</p>");
//					} else if(!idRegex.test(idVal2)) {
//						$('#idMessage').html("<p style='font-size:10px; color:red'>아이디는 영문, 숫자 조합으로 구성되어야 합니다.</p>");
//					} else {
//						$('#idMessage').html("<p style='font-size:10px; color:blue'>사용 가능한 아이디입니다.</p>");
//						$.ajax ({
//							type : 'post',
//							url : 'idCheck.do',
//							data : $('#idBox').serialize(),
//							dataType : "json",
//							success : function(data) {
//								console.log(data);
//
//
//							},
//							error: function(req) {
//								alert("상태 : " + req.status + ", " + req.responseText + ", error :" + req.error);
//							}
//            			});
//					}
//                } else {
//                    $('#idMessage').html("<p style='font-size:10px; color:red'>사용중이거나 사용 불가한 아이디입니다.</p>");
//                }	
//        };
	
		// 아이디 실시간 검색.....
		function overlapId() {
			
            $.ajax ({
                type : 'post',
                url : 'idCheck.do',
                data : $('#idBox').serialize(),
                dataType : "json",
                success : function(data) {
                    console.log(data);
                    var result = data[0].result;
					var idVal = $('#idBox').val().length;
					var idVal2 = $('#idBox').val();
					var idRegex = /^[a-z]+[a-z0-9]{6,12}$/g;
					
                    console.log(result);
					// 1번
					if(idVal2 == "") {
						$('#idMessage').html("<p style='font-size:10px; color:red'>아이디는 필수 입력 사항입니다.</p>");
						$('#idBox').focus();
						idTF = false;
					} else if(result == 'fail') {
						if(idVal < 6 || idVal > 12) {
							$('#idMessage').html("<p style='font-size:10px; color:red'>아이디는 6자 이상, 12자 이하여야 합니다.</p>");
							idTF = false;
						} else if(!idRegex.test(idVal2)) {
							$('#idMessage').html("<p style='font-size:10px; color:red'>아이디는 영문, 숫자 조합으로 구성되어야 합니다.</p>");
							idTF = false;
						} else {
							$('#idMessage').html("<p style='font-size:10px; color:blue'>사용 가능한 아이디입니다.</p>");
							idTF = true;
						}
                    } else {
                        $('#idMessage').html("<p style='font-size:10px; color:red'>사용중이거나 사용 불가한 아이디입니다.</p>");
						idTF = false;
                    }
                    
					
					
                },
                error: function(req) {
                    alert("상태 : " + req.status + ", " + req.responseText + ", error :" + req.error);
                }
            });  
        };
    
    
    // 전화번호 입력시 하이픈(-) 자동 입력
    function autoHypen() {
        var x = document.getElementById("phoneBox");
        x.value = x.value.replace(/[^0-9]/g, '');
        var tmp = "";

        if (x.value.length > 3 && x.value.length <= 7) {
            tmp += x.value.substr(0, 3);
            tmp += '-';
            tmp += x.value.substr(3);
            x.value = tmp;
        } else if (x.value.length > 7) {
            tmp += x.value.substr(0, 3);
            tmp += '-';
            tmp += x.value.substr(3, 4);
            tmp += '-';
            tmp += x.value.substr(7);
            x.value = tmp;
        }
    }
	
	
	// 생년월일 유효성 체크
	function checkBirth() {
		var year = $('#yearBox').val();
		var month = $('#monthBox').val();
		var day = $('#dayBox').val();
		var today = new Date(); // 현재 날짜(년월일)
		var yearNow = today.getFullYear();
		
		if(year == '' || month == '' || day == '') {
			if(year < 1900 || year > yearNow) {
				alert("년도를 확인하세요.");
				birthTF = false;
			}
			if(month < 1 || month > 12) {
				alert("월을 확인하세요.");
				birthTF = false;
			}
			if(day < 1 || day > 31) {
				alert("1일부터 31일까지 입력가능합니다.");
				birthTF = false;
			}
			if((month == 4 || month == 6 || month == 9 || month == 11) && day == 31) {
				alert(month + "월은 31일이 존재하지 않습니다.");
				birthTF = false;
			}
			if(month == 2) {
				var checkFeb = (year % 4 == 0 && (year % 100 != 0 || year % 400 == 0));
				if(day > 29 || (day == 29 && !checkFeb)) {
					alert(year + "년 2월은 " + day + "일이 없습니다. 다시 입력해주세요.");
					birthTF = false;
				}
			}
		} else {
			birthTF = true;
		}

	}
	

    
</script>
<title>Insert title here</title>
</head>

<body>
	<form id="personalInfo" action="signUp.do" method="post">
        
        <div class="container">
            <h3 class="mainText">회원가입</h3>
            <div class="idpwContaioner">
                <div>
                    <input type="text" name="signUpId" placeholder="아이디" class="inputBox" maxlength='14' id="idBox" onkeyup="overlapId()" />
                    <div id="idMessage"></div>
                </div>
                <div>
                    <input type="password" name="signUpPw" placeholder="비밀번호" maxlength='16' id="pwBox" class="inputBox" onkeyup="checkPassword2()"/>
                </div>
                <div>
                    <input type="password" name="signUpPw2" placeholder="비밀번호 확인" maxlength='16' id="pwBox2" class="inputBox" onkeyup="checkPassword()"/>
                    <div id="pwMessage"></div>
                </div>
            </div>    

            <div class="infoContainer">
                <!--<div>사진 : <input type="file" name="signUpImg" multiple="multiple" enctype="multipart/form-data"/></div>-->
                <div>
					<input type="text" name="signUpName" placeholder="이름 (한글만)" maxlength='20' id="nameBox" class="inputBox"/> 
					<div id="nameMessage"></div>
				</div>
                <div id="genderDiv">
<!--
                    <div id="genderSmallDiv">
                        <span name="signUpGender" value="남자" class="genderBtn" id="man">남자</span>
                        <span name="signUpGender" value="여자"  class="genderBtn" id="woman">여자</span>
                    </div>
-->
                    <input type="radio" name="signUpGender" value="M"  class="genderBtn" id="man" onclick="test(this)" checked />남자
                    <input type="radio" name="signUpGender" value="F"  class="genderBtn" id="woman" onclick="test(this)"/>여자
                </div>
                <div>
                    <input type="text" name="signUpBirthYear" placeholder="년 (4자리)" id="yearBox" class="inputBox" maxlength='4'/>
                    <select name="signUpBirthMonth" placeholder="월" id="monthBox" class="inputBox">
                        <option value="00">월</option>
                        <option value="01">1</option>
                        <option value="02">2</option>
                        <option value="03">3</option>
                        <option value="04">4</option>
                        <option value="05">5</option>
                        <option value="06">6</option>
                        <option value="07">7</option>
                        <option value="08">8</option>
                        <option value="09">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select>
<!--                    <input type="text" name="signUpBirth" placeholder="" id="monthBox" class="inputBox"/>-->
                    <input type="text" name="signUpBirthDay" placeholder="일" id="dayBox" class="inputBox" maxlength='2'/>
                </div>
                <div><input type="tel" name="signUpPhone" placeholder="전화번호" maxlength="13" id="phoneBox" class="inputBox" onkeyup="autoHypen()"/></div>
				<div id="question" class="textBox">					
					<select name="signUpQuestion" id="questionBox" class="inputBox">
						<option>- 선택 -</option>
						<option>졸업한 초등학교 이름은 ?</option>
						<option>어머니의 고향은 ?</option>
						<option>자신의 첫사랑 이름은 ?</option>
						<option>가장 인상 깊었던 여행지는 ?</option>
					</select>
				</div>
				<div>
                    <input type="text" name="signUpAnswer" placeholder="본인확인 질문 답변 " class="inputBox" id="answerBox" />
                    <div id="idMessage"></div>
                </div>
				
            </div>



            <div id="btn">
<!--                <input type="submit" value="확인" />-->
                <input type="button" value="확인" class="btns" onclick="signUpEnter()"/>
                <input type="button" value="취소" class="btns" />
            </div>
		</div>
		
	</form>
</body>
</html>