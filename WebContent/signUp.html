<!DOCTYPE html>
<html>
<head>
    
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="js/jquery-3.2.1.min.js"></script>    
<style>
    * {
        background-color: #D7D2BF;
    }
    .mainText {
        margin-top: 100px;
    }
    
    .container {
        text-align: center;
        width: 450px;
        margin: 0 auto;
        
    }
    
    .idpwContaioner {
/*        border: 1px solid darkgray;*/
        margin: 70px 0 50px 0;
        
    }
    
    .infoContainer {
/*        border: 1px solid darkgray;*/
        margin-bottom: 50px;
    }
    
    .inputBox{
        width: 80%;
        height: 32px;
        margin: 6px 0;
        padding-left: 8px;  
        border: none;
        border-bottom: 1px solid darkgray;
    }
    
    
    #genderDiv {
/*        height: 40px;*/
/*        border: 1px solid darkgray;*/
/*        position: relative;*/
        margin-top: 20px;
    }
    #genderSmallDiv {
        position: absolute;
        text-align: center;
        height: 38px;
    }
    
    .genderBtn {
        border: none;
        background-color: white;
        height: 30px;
        color: darkgray;
/*        margin: 0;*/
/*
        float: left;
        display: inline-block;
*/
/*        width: 30%;*/
    }
    #man {
        border: 1px solid darkgray;
/*        width: 135px;*/
    }
    #woman {
        border: 1px solid darkgray;
/*        width: 135px;*/
    }
    
    .btns {
        width: 25%;
        border: none;
        height: 30px;
        margin: 6px 0 0 0;
        background-color: #80aaff;
        color: white;
    }
    #yearBox{
        width: 25%;
    }
    #monthBox{
        width: 25%;
    }
    #dayBox{
        width: 25%;
    }

    
</style>
    
<script>
    // 성별 M/F
    function test(a) {
        console.log($(a).val());
    }
    
    
    function signUpEnter() {
        // 빈칸인 상태에서 회원가입 눌렀을때 검사........ 성별을 어떻게 검사할지 아직..
//        regexIdCheck();
//        regexPwCheck();
        if($('#idBox').val() == "") {
            alert("아이디를 입력하세요.");
            $('#idBox').focus();
        }  else if($('#pwBox').val() == "") {
            alert("비밀번호를 입력하세요.");
            $('#pwBox').focus();
        } else if($('#nameBox').val() == "") {
            alert("이름을 입력하세요.");
            $('#nameBox').focus();
        } else if($('#birthBox').val() == "") {
            alert("생년월일을 입력하세요.");
            $('#birthBox').focus();
        } else if($('#phoneBox').val() == "") {
            alert("전화번호를 입력하세요.");
            $('#phoneBox').focus();
        } else {
            $.ajax ({
				type : 'post',
				url : 'signUp.do',
				data : $('#personalInfo').serialize(),
	//            data :
	//            {
	//                signUpId : document.getElementById("signUpId").value,
	//                signUpPw : document.getElementById("signUpPw").value,
	//                signUpImg : document.getElementById("signUpImg").value,
	//                signUpName : document.getElementById("signUpName").value,
	//                signUpGender : document.getElementById("signUpGender").value,
	//                signUpBirth : document.getElementById("signUpBirth").value,
	//                signUpPhone : document.getElementById("signUpPhone").value
	//            },
				dataType : "json",
				success : function(data) {
					console.log(data);
					var result = data[0].result;


					alert('회원가입이 완료되었습니다.');
					location.href="index.html";

				},
				error: function(req) {
					alert("상태 : " + req.status + ", " + req.responseText + ", error :" + req.error);
				}
        });
        }
      
        
    }
    
    // 아이디 정규식 체크
    function regexIdCheck() {
        var retVal = false;
        var idVal = $('#idBox').val().length;
        var idVal2 = $('#idBox').val();
        var idRegex = /^[a-z]+[a-z0-9]{6,12}$/g;
        console.log(idVal);
		console.log(idVal2);
		// 아이디 길이 검사
        if(idVal < 6 || idVal > 12) { // 1~5거나, 13이상 이면
            alert("아이디는 6자 이상, 12자 이하여야 합니다.");
//            $('#idMessage').html("<p style='font-size:10px; color:red'>아이디는 6자 이상, 12자 이하여야 합니다.</p>");
        } else {
            retVal = true;
        }
        return retVal;
		
		// 정규식 검사
		if(!idRegex.test(idVal2)) {
            alert("아이디는 영문, 숫자 조합으로 구성되어야 합니다.");
        } else {
			retVal = true;
		}
		return retVal;
		
		
		
    }
    

    // 비밀번호 길이, 같은지, 정규식 검사
    function onkeyupPwCheck() {
        var pw1 = $('#pwBox').val();
        var pw2 = $('#pwBox2').val();
        var pwVal = $('#pwBox').val().length;
        var retVal = false;
        var pwRegex = /^.*(?=.{6,20})(?=.*[0-9])(?=.*[a-zA-Z]).*$/; // 영문, 숫자 조합
        
		console.log(pw1);
		console.log(pw2);
		console.log(pwVal);
		
		
		// 비밀번호
        if(pw1 != null && pw2 != null) {
            if(pwVal < 8 || pwVal > 16) {
                $('#pwMessage').html("<p style='font-size:10px; color:red'>비밀번호는 8자 이상, 16자 이하여야 합니다.</p>");
            } else if(pw1 != pw2) {
                $('#pwMessage').html("<p style='font-size:10px; color:red'>사용할 수 없는 비밀번호입니다.</p>");
            } else if(!pwRegex.test(pwVal)){
                $('#pwMessage').html("<p style='font-size:10px; color:red'>비밀번호는 영문, 숫자로 구성되어야 합니다.</p>");
            } else {
                $('#pwMessage').html("<p style='font-size:10px; color:blue'>사용 가능한 비밀번호입니다.</p>");
            }
        }
        
    }

    
    
    // 회원가입시 아이디 실시간 검사 진행중......................
        function overlapId() {
            $.ajax ({
                type : 'post',
                url : 'idCheck.do',
                data : $('#idBox').serialize(),
                dataType : "json",
                success : function(data) {
                    console.log(data);
                    var result = data[0].result;
					var idVal = $('#idBox').val().length;
					var idVal2 = $('#idBox').val();
					var idRegex = /^[a-z]+[a-z0-9]{6,12}$/g;
					
                    console.log(result);
					// 1번
                    if(result == 'fail') {
						if(idVal < 6 || idVal > 12) {
							$('#idMessage').html("<p style='font-size:10px; color:red'>아이디는 6자 이상, 12자 이하여야 합니다.</p>");
						} else if(!idRegex.test(idVal2)) {
							$('#idMessage').html("<p style='font-size:10px; color:red'>아이디는 영문, 숫자 조합으로 구성되어야 합니다.</p>");
						} else {
							$('#idMessage').html("<p style='font-size:10px; color:blue'>사용 가능한 아이디입니다.</p>");
						}
                    } else {
                        $('#idMessage').html("<p style='font-size:10px; color:red'>사용중이거나 사용 불가한 아이디입니다.</p>");
                    }
					
                },
                error: function(req) {
                    alert("상태 : " + req.status + ", " + req.responseText + ", error :" + req.error);
                }
            });    
        };
    
    
    // 전화번호 입력시 하이픈(-) 자동 입력
    function autoHypen() {
        var x = document.getElementById("phoneBox");
        x.value = x.value.replace(/[^0-9]/g, '');
        var tmp = "";

        if (x.value.length > 3 && x.value.length <= 7) {
            tmp += x.value.substr(0, 3);
            tmp += '-';
            tmp += x.value.substr(3);
            x.value = tmp;
        } else if (x.value.length > 7) {
            tmp += x.value.substr(0, 3);
            tmp += '-';
            tmp += x.value.substr(3, 4);
            tmp += '-';
            tmp += x.value.substr(7);
            x.value = tmp;
        }
    }
	
	
	function jsDayCheck(Obj) {
		var strValue = Obj.value;
		var chk1 = /^(19|20)\d{2}-([1-9]|1[012])-([1-9]|[12][0-9]|3[01])$/;
		var chk2 = /^(19|20)\d{2}\/([0][1-9]|1[012])\/(0[1-9]|[12][0-9]|3[01])$/;
		if (strValue == "") { // 공백이면 무시
			 return true;
		}

		//-------------------------------------------------------------------------------
		// 유효성 검사- 입력형식에 맞게 들왔는지 // 예) 2000-1-1, 2000-01-01 2가지 형태 지원
		//-------------------------------------------------------------------------------
		if (chk2.test(strValue) == false) { // 유효성 검사에 성공하지 못했다면
			alert("1999-1-1 형식 또는 \r\n1999-01-01 형식으로 날자를 입력해주세요.");
			Obj.value = "";
			Obj.focus = true;
		   	return false;
		}

		//-------------------------------------------------------------------------------
		// 존재하는 날자(유효한 날자) 인지 체크
		//-------------------------------------------------------------------------------
		var bDateCheck = true;
		var arrDate = Obj.value.split("-");
		var nYear = Number(arrDate[0]);
		var nMonth = Number(arrDate[1]);
		var nDay = Number(arrDate[2]);

		if (nYear < 1900 || nYear > 3000) { // 사용가능 하지 않은 년도 체크
			bDateCheck = false;
		}

		if (nMonth < 1 || nMonth > 12) { // 사용가능 하지 않은 달 체크
			bDateCheck = false;
		}

		// 해당달의 마지막 일자 구하기
		var nMaxDay = new Date(new Date(nYear, nMonth, 1) - 86400000).getDate();
		if (nDay < 1 || nDay > nMaxDay) { // 사용가능 하지 않은 날자 체크
			bDateCheck = false;
		}

		if(bDateCheck == false) { 
		   alert("존재하지 않은 년월일을 입력하셨습니다. 다시한번 확인해주세요");
		   return false;
		}
	}

    
</script>
<title>Insert title here</title>
</head>

<body>
	<form id="personalInfo" action="signUp.do" method="post">
        
        <div class="container">
            <h3 class="mainText">회원가입</h3>
            <div class="idpwContaioner">
                <div>
                    <input type="text" name="signUpId" placeholder="아이디" class="inputBox" maxlength='14' id="idBox" onkeyup="overlapId()" />
                    <div id="idMessage"></div>
                </div>
                <div>
                    <input type="password" name="signUpPw" placeholder="비밀번호" maxlength='16' id="pwBox" class="inputBox"/>
                </div>
                <div>
                    <input type="password" name="signUpPw2" placeholder="비밀번호 확인" maxlength='16' id="pwBox2" class="inputBox" onkeyup="onkeyupPwCheck()"/>
                    <div id="pwMessage"></div>
                </div>
            </div>    

            <div class="infoContainer">
                <!--<div>사진 : <input type="file" name="signUpImg" multiple="multiple" enctype="multipart/form-data"/></div>-->
                <div><input type="text" name="signUpName" placeholder="이름" maxlength='20' id="nameBox" class="inputBox"/> </div>
                <div id="genderDiv">
<!--
                    <div id="genderSmallDiv">
                        <span name="signUpGender" value="남자" class="genderBtn" id="man">남자</span>
                        <span name="signUpGender" value="여자"  class="genderBtn" id="woman">여자</span>
                    </div>
-->
                    <input type="radio" name="signUpGender" value="M"  class="genderBtn" id="man" onclick="test(this)" checked />남자
                    <input type="radio" name="signUpGender" value="F"  class="genderBtn" id="woman" onclick="test(this)"/>여자
                </div>
                <div>
                    <input type="text" name="signUpBirthYear" placeholder="년(4자리)" id="yearBox" class="inputBox" maxlength='4'/>
                    <select name="signUpBirthMonth" placeholder="월" id="monthBox" class="inputBox">
                        <option value="00">월</option>
                        <option value="01">1</option>
                        <option value="02">2</option>
                        <option value="03">3</option>
                        <option value="04">4</option>
                        <option value="05">5</option>
                        <option value="06">6</option>
                        <option value="07">7</option>
                        <option value="08">8</option>
                        <option value="09">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select>
<!--                    <input type="text" name="signUpBirth" placeholder="" id="monthBox" class="inputBox"/>-->
                    <input type="text" name="signUpBirthDay" placeholder="일" id="dayBox" class="inputBox" maxlength='2'/>
                </div>
                <div><input type="tel" name="signUpPhone" placeholder="전화번호" maxlength="13" id="phoneBox" class="inputBox" onkeyup="autoHypen()"/></div>
				<div id="question" class="textBox">					
					<select name="signUpQuestion" id="questionBox" class="inputBox">
						<option>- 선택 -</option>
						<option>졸업한 초등학교 이름은 ?</option>
						<option>어머니의 고향은 ?</option>
						<option>자신의 첫사랑 이름은 ?</option>
						<option>가장 인상 깊었던 여행지는 ?</option>
					</select>
				</div>
				<div>
                    <input type="text" name="signUpAnswer" placeholder="본인확인 질문 답변 " class="inputBox" id="answerBox" />
                    <div id="idMessage"></div>
                </div>
				
            </div>



            <div id="btn">
<!--                <input type="submit" value="확인" />-->
                <input type="button" value="확인" class="btns" onclick="signUpEnter()"/>
                <input type="button" value="취소" class="btns" />
            </div>
		</div>
		
	</form>
</body>
</html>